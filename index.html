<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>When Randos Attack!</title>
        <link href='https://fonts.googleapis.com/css?family=Candal' rel='stylesheet' type='text/css'>
        <style>
          html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
          }
        </style>
    </head>
    <body>
    </body>
    <script type="text/javascript" language="javascript">
      var canvas = document.createElement('canvas');
      document.body.appendChild(canvas);
      canvas.height = window.innerHeight;
      canvas.width = window.innerWidth;
      var ctx = canvas.getContext('2d');
      var fps = 30;

      var totalHeads = [];

      window.onresize = function() {
        canvas.height = window.innerHeight;
        canvas.width = window.innerWidth;
      };

      var assets = {
        background: {
          src: 'assets/images/bg.png'
        },
        kaylah: {
          src: 'assets/images/kaylah.png'
        },
        guy1: {
          src: 'assets/images/guy1.png'
        },
        guy2: {
          src: 'assets/images/guy2.png'
        },
        guy3: {
          src: 'assets/images/guy3.png'
        },
        guy4: {
          src: 'assets/images/guy4.png'
        },
        guy5: {
          src: 'assets/images/guy5.png'
        },
        guy6: {
          src: 'assets/images/guy6.png'
        },
      };

      function Enemy() {
        this.img = assets['guy' + Math.floor((Math.random() * 6) + 1)].img;
        this.w = this.img.width;
        this.h = this.img.height;
        this.x = Math.ceil(Math.random() * (canvas.width));
        this.y = -(this.h * 2);
        this.speed = Math.floor((Math.random() * 5) + 2);
        this.attackedKaylah = false;

        this.target = {
          x: (canvas.width / 2),
          y: canvas.height - assets.kaylah.img.height,
        };

        this.update = function() {
          var dx = this.x - this.target.x;
          var dy = this.y - this.target.y;
          var dist = Math.sqrt(dx * dx + dy * dy);

          if (dist > 4) {
            this.y -= (dy / dist) * this.speed;
            this.x -= (dx / dist) * this.speed;
          } else {
            this.attackedKaylah = true;
          }
        };

        this.draw = function() {
          ctx.drawImage(this.img, this.x, this.y);
        };
      }

      var enemies = [];

      function initGame() {
        totalLives = 5;
        totalScore = 0;
        setInterval(gameLoop, 1000 / 30);
      }

      
      function touchOrClick(e) {
        if (e.which === 1) {
          if (e.target === canvas) {
            var clickX = e.clientX;
            var clickY = e.clientY;

            for (var i = 0; i < enemies.length; i++) {
              var enemy = enemies[i];

              if (clickX >= enemy.x && clickX <= enemy.x + enemy.w && clickY >= enemy.y && clickY <= enemy.y + enemy.h) {
                enemies.splice(i, 1);
                totalScore += 10;
              }
            }
          }
        }
      };

      document.addEventListener('mousedown', touchOrClick);
      document.addEventListener('touchend', touchOrClick);
      // document.addEventListener('mousedown', touchOrClick);

      

      function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        while (enemies.length != 10) {
          enemies.push(new Enemy());
        }

        draw();

        for (var i = 0; i < enemies.length; i++) {
          if (totalLives <= 0) {
            break;      
            if (score <= 100) {
              // <= 100 End Game text
              ctx.font = "72px Comic Sans MS";
              ctx.fillStyle = "#fff";
              ctx.textAlign = "left";
              ctx.fillText("Lives: ", canvas.width / 15, canvas.height - 37);
            }
            //location.reload(); // Reloads page
          }

          if (enemies[i].attackedKaylah) {
            totalLives--;
            enemies.splice(i, 1);
            continue;
          }

          enemies[i].update();
          enemies[i].draw();
        }

        drawKaylah();
      }



      // function initGame() {
      //   totalHeads = [];
      //   totalLives = 3;
      //   totalScore = 0;

      //   var randomNum = Math.floor(Math.random() * 6) + 1,
      //   randomGuy = assets["guy" + randomNum].img,
      //   guyWidth = randomGuy.width,
      //   guyHeight = randomGuy.height,
      //   guyX = Math.ceil(Math.random() * (canvas.width - guyWidth)),
      //   guyY = -(guyHeight),
      //   kaylahCenterX = canvas.width / 2,
      //   kaylahCenterY = canvas.height - 150,
      //   guyCenterX = guyX + (guyWidth / 2),
      //   guyCenterY = guyY + (guyHeight / 2),
      //   kaylahX = (canvas.width / 2) - (assets.kaylah.img.width / 2),
      //   kaylahY = canvas.height - assets.kaylah.img.height;

      //   var head = {
      //     x: guyX,
      //     y: guyY,
      //     update: function() {
      //       if (guyCenterX < kaylahCenterX) {
      //         guyX += -(guyCenterX - kaylahCenterX) / 200;
      //         guyY += -(guyCenterY - kaylahCenterY) / 200;
      //         console.log("guyX moved right!");
      //       } else if (guyCenterX > kaylahCenterX) {
      //         guyX += -(guyCenterX - kaylahCenterX) / 200;
      //         guyY += -(guyCenterY - kaylahCenterY) / 200;
      //          console.log("guyX moved left!");
      //        }



      //     },
      //     draw: function() {
      //       ctx.drawImage(randomGuy, guyX, guyY, guyWidth, guyHeight);

      //       //Marking centers of images for reference
      //       ctx.fillStyle = 'yellow';
      //       ctx.fillRect(guyCenterX, guyCenterY, 5, 5);
      //       ctx.fillRect(kaylahCenterX, kaylahCenterY, 5, 5);

      //       // Collision detection
      //       if (kaylahX < guyX + randomGuy.width &&
      //          kaylahX + (assets.kaylah.img.width - 50) > guyX &&
      //          kaylahY < guyY + randomGuy.height &&
      //          (assets.kaylah.img.height - 20) + kaylahY > guyY) {
      //           totalLives = totalLives - 1;
      //           totalHeads.pop(head);
      //       }

      //     }
      //   };

      //   totalHeads.push(head);

      //   // function findStep() {
      //   //   step = Math.floor(Math.random() * 10) + 5;
      //   //   console.log("Step Value: " + step);
      //   // }

      //   setInterval(gameLoop(), 1000 / fps);

      // }






      // function gameLoop() {
      //   ctx.clearRect(0, 0, canvas.width, canvas.height);

      //   draw();

      //   for (var i = 0; i < totalHeads.length; i++) {
      //     totalHeads[i].update();
      //     totalHeads[i].draw();
      //   };

      //   drawKaylah();

      //   requestAnimationFrame(gameLoop);
      // }






      function draw() {
        // Draw background image to canvas
        ctx.drawImage(assets.background.img, 0, 0, canvas.width, canvas.height);

      //   var randomNum = Math.floor(Math.random() * 6) + 1;
      //   var randomGuy = assets["guy" + randomNum].img;
      //   var guyWidth = randomGuy.width/3;
      //   var guyHeight = randomGuy.height/3;
      //   var guyX = Math.ceil(Math.random() * (canvas.width - guyWidth));
      //   var guyY = 100; //-(guyHeight);
      //   ctx.drawImage(randomGuy, guyX, guyY, guyWidth, guyHeight);

        // Draw Score Panel
        ctx.fillStyle = '#000';
        ctx.fillRect(0, canvas.height - 150, canvas.width, 150);

        // Draw lives text
        ctx.font = "60px Arial Black";
        ctx.fillStyle = "#fff";
        ctx.textAlign = "left";
        ctx.fillText("Lives: ", 10, canvas.height - 90);


        ctx.font = "60px Arial Black";
        ctx.fillStyle = "#fff";
        ctx.textAlign = "left";
        ctx.fillText("Score: ", canvas.width / 1.55, canvas.height - 90);

        // Draw lives to canvas
        var livesWidth = assets.kaylah.img.width / 5;
        var livesHeight = assets.kaylah.img.height / 5;
        var livesX = 10;
        var livesY = canvas.height - (livesHeight + 10);

        //Loop to draw # of heads per lives.
        for (var i = 0; i < totalLives; i++) {
          ctx.drawImage(assets.kaylah.img, livesX, livesY, livesWidth, livesHeight);
          livesX += livesWidth + 5;
        }

        // Draw totalScore text
        ctx.font = "72px Comic Sans MS";
        ctx.fillStyle = "#fff";
        ctx.textAlign = "left";
        ctx.fillText(totalScore, canvas.width / 1.25, canvas.height - 10);
      }

      function drawKaylah() {
        // Draw Kaylah to canvas
        
        var kaylahWidth,
            kaylahHeight,
            kaylahX,
            kaylahY;

        if (canvas.width <= 414) {
          kaylahWidth = assets.kaylah.img.width / 2;
          kaylahHeight = assets.kaylah.img.height / 2;
        } else if (canvas.height <= 736) {
          kaylahWidth = assets.kaylah.img.width / 1.5;
          kaylahHeight = assets.kaylah.img.height / 1.5;
        } else {
          kaylahWidth = assets.kaylah.img.width;
          kaylahHeight = assets.kaylah.img.height;
        }
        kaylahX = (canvas.width / 2) - (kaylahWidth / 2);
        kaylahY = canvas.height - kaylahHeight;
        ctx.drawImage(assets.kaylah.img, kaylahX, kaylahY, kaylahWidth, kaylahHeight);      

      }




      function loadAssets() {
        var loaded = 0;

        for (var i in assets) {
          assets[i].img = new Image();
          assets[i].img.addEventListener('load', function() {
            loaded++;

            if (loaded === Object.keys(assets).length) {
              initGame();
            }
          });
          assets[i].img.src = assets[i].src;
        }
      }

      loadAssets();



      ///////////////////////////////////////////////////////////////////////////////////////////

      // var canvas;
      // var ctx;
      // window.onload = function() {
      //   canvas = document.getElementById("gameCanvas");
      //   resize();
      // }

      // function resize() {
      //   ctx = canvas.getContext("2d");
      //   canvas.width = window.innerWidth;
      //   canvas.height = window.innerHeight;
      //   //Background image placeholder
      //     ctx.fillStyle = '#666';
      //     ctx.fillRect(0, 0, canvas.width, canvas.height);

      //   //Background image displayed
      //   var background = new Image();
      //   background.onload = function()
      //   {
      //   ctx.drawImage(background, -background.width/2, 0);
      //   };
      //   background.src = "assets/images/bgdark.jpg";

      //   drawStatsPanel()
      //   drawKaylah();

      // }

      // function drawStatsPanel() {
      //   //Create the Stats panel
      //   ctx.fillStyle = '#000';
      //   ctx.fillRect(0, canvas.height-50, canvas.width, 50);
      // }


      // function drawKaylah() {
      //   //Kaylah image displayed
      //   var kaylah = new Image();
      //   kaylah.onload = function()
      //   {
      //   ctx.drawImage(kaylah, canvas.width/2-kaylah.width/2, canvas.height-kaylah.height);
      //   };
      //   kaylah.src = "assets/images/kaylah.png";
      // }
      ///////////////////////////////////////////////////////////////////////////////////////////


      // function calcDiff(x, y) {
      //   var x_Diff = x - kaylahCenterX;
      //   var y_Diff = kaylahCenterY - y;
      //   return [x_Diff, y_Diff];
      // }

      // function calcStep(distanceX, distanceY, step) {
      //   var stepTotalX = distanceX / step;
      //   var stepTotalY = distanceY / step;
      //   return [stepTotalX, stepTotalY];
      // }

      // var difference = calcDiff(guyX, guyY);
      // var travelDistance = calcStep(difference[0], difference[1], 5);
    </script>
</html>